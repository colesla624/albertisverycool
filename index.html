<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>First Person Game Hub</title>
<style>
  body { margin:0; overflow:hidden; background:#0b1026; font-family:sans-serif; color:#e9ecff; }
  #menu {
    position:absolute; top:0; left:0; right:0; bottom:0;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    background:#0b1026; z-index:10;
  }
  #menu h1 { margin-bottom:20px; }
  #menu button {
    margin:8px; padding:12px 24px; font-size:18px;
    background:#202859; color:#e9ecff; border:1px solid #4450a8; border-radius:8px;
    cursor:pointer;
  }
  #hud { position:fixed; top:10px; left:50%; transform:translateX(-50%); font-size:14px; display:none; }
  .stick {
    position:fixed; bottom:16px; width:120px; height:120px; border-radius:50%;
    background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.18);
    touch-action:none;
  }
  #stickLeft { left:16px; }
  #stickRight { right:16px; }
  .knob {
    position:absolute; left:50%; top:50%; width:54px; height:54px; border-radius:50%;
    transform:translate(-50%,-50%); background:rgba(97,225,255,0.35);
  }
  #btnJump {
    position:fixed; right:18px; bottom:150px; width:76px; height:76px; border-radius:50%;
    background:#202859; color:#e9ecff; font-size:16px;
  }
</style>
</head>
<body>
<div id="menu">
  <h1>Game Hub</h1>
  <button onclick="startGame('platformer')">Platformer</button>
  <button onclick="startGame('maze')">Maze Explorer</button>
  <button onclick="startGame('shooter')">Shooter Demo</button>
</div>
<div id="hud">HUD</div>
<div id="stickLeft" class="stick"><div class="knob"></div></div>
<div id="stickRight" class="stick"><div class="knob"></div></div>
<button id="btnJump">Jump</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
let scene, camera, renderer, loopId;
let moveStick={x:0,y:0}, lookStick={x:0,y:0};
let player={pos:new THREE.Vector3(0,2,5),vel:new THREE.Vector3(),yaw:0,pitch:0,grounded:false,speed:6,jumpVel:5.5};
const hud=document.getElementById("hud");

function initRenderer(){
  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth,window.innerHeight);
  document.body.appendChild(renderer.domElement);
  window.addEventListener("resize",()=>{camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight);});
}

function setupStick(el,onMove){
  const knob=el.querySelector(".knob"); let active=false;
  el.addEventListener("touchstart",()=>{active=true;},{passive:true});
  el.addEventListener("touchmove",e=>{
    if(!active)return; const rect=el.getBoundingClientRect(); const t=e.touches[0];
    const dx=t.clientX-(rect.left+rect.width/2); const dy=t.clientY-(rect.top+rect.height/2);
    const r=50,mag=Math.hypot(dx,dy),cl=mag>r?r/mag:1; const nx=dx*cl,ny=dy*cl;
    knob.style.transform=`translate(${nx}px,${ny}px) translate(-50%,-50%)`; onMove(nx/r,ny/r); e.preventDefault();
  },{passive:false});
  function reset(){active=false;knob.style.transform="translate(-50%,-50%)";onMove(0,0);}
  el.addEventListener("touchend",reset,{passive:true});
  el.addEventListener("touchcancel",reset,{passive:true});
}
setupStick(document.getElementById("stickLeft"),(x,y)=>{moveStick.x=x;moveStick.y=y;});
setupStick(document.getElementById("stickRight"),(x,y)=>{lookStick.x=x;lookStick.y=y;});

document.getElementById("btnJump").addEventListener("click",()=>{if(player.grounded){player.vel.y=player.jumpVel*2;player.grounded=false;}});

function startGame(type){
  document.getElementById("menu").style.display="none";
  hud.style.display="block";
  if(!renderer) initRenderer();
  scene=new THREE.Scene();
  camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
  camera.position.copy(player.pos);
  scene.add(new THREE.HemisphereLight(0x8a5cff,0x0b1026,0.8));
  const dir=new THREE.DirectionalLight(0xffffff,0.8);dir.position.set(20,30,10);scene.add(dir);

  if(type==="platformer"){setupPlatformer();}
  if(type==="maze"){setupMaze();}
  if(type==="shooter"){setupShooter();}

  cancelAnimationFrame(loopId);
  loop();
}

function setupPlatformer(){
  hud.textContent="Platformer: collect crystals!";
  const ground=new THREE.Mesh(new THREE.BoxGeometry(40,1,40),new THREE.MeshStandardMaterial({color:0x1b2250}));
  ground.position.y=-0.5;scene.add(ground);
  const plat=new THREE.Mesh(new THREE.BoxGeometry(6,1,6),new THREE.MeshStandardMaterial({color:0x61e1ff}));
  plat.position.set(0,2,0);scene.add(plat);
  const crystal=new THREE.Mesh(new THREE.ConeGeometry(0.5,1.5,6),new THREE.MeshStandardMaterial({color:0xffd46b}));
  crystal.position.set(0,3,0);scene.add(crystal);
}

function setupMaze(){
  hud.textContent="Maze Explorer: find your way!";
  const floor=new THREE.Mesh(new THREE.PlaneGeometry(40,40),new THREE.MeshStandardMaterial({color:0x1b2250}));
  floor.rotation.x=-Math.PI/2;scene.add(floor);
  const wallMat=new THREE.MeshStandardMaterial({color:0x61e1ff});
  for(let i=-20;i<=20;i+=5){
    const wall=new THREE.Mesh(new THREE.BoxGeometry(1,3,5),wallMat);
    wall.position.set(i,1.5,0);scene.add(wall);
  }
}

function setupShooter(){
  hud.textContent="Shooter Demo: shoot targets!";
  const floor=new THREE.Mesh(new THREE.PlaneGeometry(40,40),new THREE.MeshStandardMaterial({color:0x1b2250}));
  floor.rotation.x=-Math.PI/2;scene.add(floor);
  const targetMat=new THREE.MeshStandardMaterial({color:0xff0000});
  for(let i=0;i<5;i++){
    const target=new THREE.Mesh(new THREE.BoxGeometry(1,1,0.2),targetMat);
    target.position.set(-10+i*5,1.5,-10);scene.add(target);
  }
}

function loop(){
  loopId=requestAnimationFrame(loop);
  const dt=0.016;
  let forward=moveStick.y; let strafe=moveStick.x;
  const len=Math.hypot(forward,strafe); if(len>1){forward/=len;strafe/=len;}
  const cos=Math.cos(player.yaw),sin=Math.sin(player.yaw);
  player.pos.x+=(strafe*cos+forward*sin)*player.speed*dt;
  player.pos.z+=(strafe*-sin+forward*cos)*player.speed*dt;
  player.vel.y-=9.8*dt; player.pos.y+=player.vel.y*dt;
  if(player.pos.y<=2){player.pos.y=2;player.vel.y=0;player.grounded=true;}
  player.yaw-=lookStick.x*2.5*dt;
  player.pitch-=lookStick.y*2.0*dt;
  const maxPitch=Math.PI/2-0.05,minPitch=-Math.PI/2+0.05;
  player.pitch=Math.max(min
